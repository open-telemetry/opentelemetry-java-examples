otel:
  # IMPORTANT:
  # 1. The auto-suggested properties are not correct, because they are based on the non-declarative config schema.
  # 2. Use https://github.com/open-telemetry/opentelemetry-configuration for details on schema and examples, but
  #    indent all examples by two spaces to fit under the "otel:" root node (for Spring Boot declarative config).

  file_format: "1.0-rc.2" # "file_format" serves as opt-in to declarative config

  resource:
    attributes:
      - name: service.name
        value: spring-boot-declarative-config-example

  propagator:
    composite:
      - tracecontext:
      - baggage:

  tracer_provider:
    processors:
      - batch:
          exporter:
            otlp_http:
              # Note: Spring uses : instead of :- as separator for the default value
              endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318}/v1/traces

      # Configure a console exporter for exploring without a collector/backend
      - batch:
          exporter:
            console:

    # Configure sampling to exclude health check endpoints
    sampler:
      rule_based_routing:
        fallback_sampler:
          always_on:
        # Filter to spans of this span_kind. Must be one of: SERVER, CLIENT, INTERNAL, CONSUMER, PRODUCER.
        span_kind: SERVER   # only apply to server spans
        # List of rules describing spans to drop. Spans are dropped if they match one of the rules.
        rules:
          # The action to take when the rule is matches. Must be of: DROP, RECORD_AND_SAMPLE.
          - action: DROP
            # The span attribute to match against.
            attribute: url.path
            # The pattern to compare the span attribute to.
            pattern: /actuator.*

  meter_provider:
    readers:
      - periodic:
          exporter:
            otlp_http:
              # Note: Spring uses : instead of :- as separator for the default value
              endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318}/v1/metrics

  logger_provider:
    processors:
      - batch:
          exporter:
            otlp_http:
              # Note: Spring uses : instead of :- as separator for the default value
              endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318}/v1/logs
